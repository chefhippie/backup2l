# Generated by Chef for <%= node["fqdn"] %>
FOR_VERSION=1.5
VOLNAME="system"

SRCLIST=(<%= @sources.join(" ") %>)
SKIPCOND=(<%= @skip %>)

BACKUP_DIR="<%= @target %>"

MAX_LEVEL=<%= @max_level %>
MAX_PER_LEVEL=<%= @max_per_level %>
MAX_FULL=<%= @max_full %>

GENERATIONS=<%= @generations %>
CREATE_CHECK_FILE=1

PRE_BACKUP()
{
  if [ ! -d /backup ]
  then
    mkdir -p /backup
  fi

  if [ -f /backup/dpkg-selections.log ]
  then
    rm /backup/dpkg-selections.log
  fi

  dpkg --get-selections > /backup/dpkg-selections.log
}

POST_BACKUP()
{
  chown -R root:root <%= @target %>
  chmod -R u=rw,go-rwx <%= @target %>
  
  [[ -f /usr/local/sbin/backupftp ]] && /usr/local/sbin/backupftp
}

AUTORUN=0
SIZE_UNITS="M"
CREATE_DRIVER="DRIVER_TAR_GZ"
